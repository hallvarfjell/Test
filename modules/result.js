const Result={ render(el,st){ el.innerHTML=''; const params=new URLSearchParams(location.hash.split('?')[1]||''); const id=params.get('id'); const s=(st.logg||[]).find(x=>x.id===id)||st.logg?.slice().pop(); if(!s){ el.textContent='Fant ikke økta.'; return; }
  const head=UI.h('div',{class:'card'}); head.append(UI.h('div',{},`Resultat – ${s.name}`), UI.h('div',{},`Slutt: ${new Date(s.endedAt).toLocaleString()}`)); el.append(head);
  const c=document.createElement('canvas'); c.width=900; c.height=260; c.style.width='100%'; const ctx=c.getContext('2d'); function draw(){ const W=c.width,H=c.height; ctx.clearRect(0,0,W,H); ctx.strokeStyle='#b4c4e8'; ctx.strokeRect(40,10,W-60,H-30); const hr=s.hrSeries||[], sp=s.spdSeries||[]; if(!hr.length&&!sp.length) return; const t0=Math.min(hr[0]?.t||Infinity, sp[0]?.t||Infinity), t1=Math.max(hr.at(-1)?.t||0, sp.at(-1)?.t||0); ctx.strokeStyle='#d93c3c'; ctx.lineWidth=2; ctx.beginPath(); hr.forEach((p,i)=>{ const x=40+((p.t-t0)/(t1-t0))*(W-60); const y=10+(1-((p.bpm-90)/100))*(H-30); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); }); ctx.stroke(); ctx.strokeStyle='#d6a600'; ctx.lineWidth=2; ctx.beginPath(); sp.forEach((p,i)=>{ const x=40+((p.t-t0)/(t1-t0))*(W-60); const y=10+(1-(p.kmh/20))*(H-30); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); }); ctx.stroke(); ctx.fillStyle='#0b1220'; ctx.font='12px system-ui'; [90,110,130,150,170,190].forEach(v=>{ const y=10+(1-((v-90)/100))*(H-30); ctx.fillText(String(v),8,y+4); }); [0,5,10,15,20].forEach(v=>{ const y=10+(1-(v/20))*(H-30); ctx.fillText(String(v), W-28, y+4); }); }
  draw(); const gCard=UI.h('div',{class:'card'}); gCard.append(UI.h('h3',{},'Puls & fart'), c); el.append(gCard);
  const tCard=UI.h('div',{class:'card'}); tCard.append(UI.h('h3',{},'Per drag')); const tbl=document.createElement('table'); tbl.className='table'; tbl.innerHTML='<tr><th>#</th><th>HR</th><th>Fart</th><th>Watt</th><th>RPE</th></tr>'; (s.perDrag||[]).forEach((d,i)=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${i+1}</td><td>${d.hr??'-'}</td><td>${d.spd??'-'}</td><td>${d.watt??'-'}</td><td>${d.rpe??'-'}</td>`; tbl.appendChild(tr); }); tCard.append(tbl); el.append(tCard);
  const extra=UI.h('div',{class:'card'}); extra.append(UI.h('h3',{},'Merknader')); const notes=UI.h('textarea',{style:'width:100%;min-height:80px;border:1px solid #c9d6f0;border-radius:8px;padding:.5rem;'}); notes.value=s.notes||''; const save=UI.h('button',{class:'btn primary',onclick:()=>{ s.notes=notes.value; Storage.saveP(AppState.currentProfile,'logg', st.logg); alert('Lagret.'); }},'Lagre merknader'); extra.append(notes, UI.h('div',{class:'controls'}, save)); el.append(extra);
}};
