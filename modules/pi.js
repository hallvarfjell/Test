// PI module view + compute (kan finpusses senere)
const PI = { compute(inputs){ const hr = inputs.hr || 0, hrmax = inputs.hrmax || 190; const spd = inputs.speedKmh || 0, inc = inputs.inclinePct || 0; const lt1 = inputs.lt1 || 135, lt2 = inputs.lt2 || 160; const load = spd * (1 + Math.max(0, inc)/100); const hrScore = (hr<=0)? 0 : Math.min(1, Math.max(0, (hr - lt1)/Math.max(1,(lt2-lt1)))); const raw = (load*4) * (0.6 + 0.4*hrScore); return Math.max(0, Math.min(100, Math.round(raw))); } };
const PIMod = { render(el, st){ el.innerHTML=''; const card = UI.h('div',{class:'card'}); card.append(UI.h('h2',{},'PI – Performance Index (forslag v0)')); const p = UI.h('p',{}, 'PI beregnes nå som et enkelt mål basert på fart*(1+stigning) og puls relativt til LT1–LT2. Dette finjusteres senere.'); const demo = UI.h('div',{class:'controls'}); const spd = UI.h('input',{class:'input',type:'number',step:'0.1',value:String(st.tm.speed||10)}); const inc = UI.h('input',{class:'input',type:'number',step:'1',value:String(st.tm.incline||1)}); const hr = UI.h('input',{class:'input',type:'number',value:String(st.hr.bpm||140)}); const out = UI.h('div',{class:'big'}, 'PI: 0'); function recalc(){ const val = PI.compute({ hr:parseInt(hr.value)||0, hrmax: st.settings.hrmax, speedKmh: parseFloat(spd.value)||0, inclinePct: parseFloat(inc.value)||0, lt1: st.settings.lt1, lt2: st.settings.lt2 }); out.textContent = 'PI: '+val; } [spd,inc,hr].forEach(i=>i.addEventListener('input', recalc)); recalc(); demo.append(UI.h('label',{},'Fart'), spd, UI.h('label',{},'Stigning %'), inc, UI.h('label',{},'Puls'), hr); card.append(p, demo, out); el.append(UI.h('h1',{class:'h1'},'PI'), card); } };
