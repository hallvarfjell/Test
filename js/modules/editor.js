
import { Store } from '../store.js';
import { $, toast } from '../helpers.js';
export function renderEditor(){ const host=document.getElementById('app'); const w=Store.data.workouts[0]; host.innerHTML=`<section class='panel'><h3>Økteditor</h3><div class='flex' style='gap:.75rem;flex-wrap:wrap'><label>Velg økt:<select id='selW' class='input'>${Store.data.workouts.map(x=>`<option value='${x.id}'>${x.name}</option>`).join('')}</select></label><button class='btn' id='btnNew'>Ny økt</button><button class='btn danger' id='btnDel'>Slett</button><input id='wName' class='input' placeholder='Navn' value='${w?w.name:''}'/><button class='btn' id='btnSave'>Lagre</button></div><div id='blocks' style='margin-top:1rem'></div><div class='footer-actions'><button class='btn' id='btnAddWarmup'>+ Oppvarming</button><button class='btn' id='btnAddSet'>+ Sett (intervaller)</button><button class='btn' id='btnAddCont'>+ Kontinuerlig</button><button class='btn' id='btnAddCooldown'>+ Nedjogg</button></div></section>`; let sel=$('#selW'); let cur=Store.data.workouts.find(x=>x.id===sel.value)||Store.data.workouts[0]; function refresh(){ const b=$('#blocks'); b.innerHTML=''; (cur.blocks||[]).forEach((bl,i)=>{ const el=document.createElement('div'); el.className='panel'; const rm=()=>{ cur.blocks.splice(i,1); Store.save(); refresh(); }; if(bl.kind==='warmup'||bl.kind==='cooldown'){ el.innerHTML=`<div class='flex'><strong>${bl.kind==='warmup'?'Oppvarming':'Nedjogg'}</strong> <button class='btn danger' data-act='rm'>Fjern</button></div><div class='flex'><label>Varighet (s)<input type='number' value='${bl.durationSec|0}' data-f='durationSec' class='input'></label><label>Fart (km/t)<input type='number' step='1' value='${bl.target?.speed||0}' data-f='speed' class='input'></label><label>Stigning (%)<input type='number' step='1' value='${bl.target?.incline||0}' data-f='incline' class='input'></label><label>Intensitet<input value='${bl.intensity||''}' data-f='intensity' class='input'></label></div>`; } else if(bl.kind==='set'){ el.innerHTML=`<div class='flex'><strong>Sett</strong> <button class='btn danger' data-act='rm'>Fjern</button></div><div class='flex'><label>Reps<input type='number' value='${bl.reps|0}' data-f='reps' class='input'></label><label>Arbeid (s)<input type='number' value='${bl.workSec|0}' data-f='workSec' class='input'></label><label>Pause (s)<input type='number' value='${bl.restSec|0}' data-f='restSec' class='input'></label><label>Fart (km/t)<input type='number' step='1' value='${bl.target?.speed||0}' data-f='speed' class='input'></label><label>Stigning (%)<input type='number' step='1' value='${bl.target?.incline||0}' data-f='incline' class='input'></label><label>Intensitet<input value='${bl.intensity||''}' data-f='intensity' class='input'></label></div>`; } else { el.innerHTML=`<div class='flex'><strong>Kontinuerlig</strong> <button class='btn danger' data-act='rm'>Fjern</button></div><div>${(bl.segments||[]).map((s,j)=>`<div class='flex' style='margin:.3rem 0'><span class='badge'>Segment ${j+1}</span><label>Varighet (s)<input type='number' value='${s.durationSec|0}' data-f='durationSec' data-i='${j}' class='input seg'></label><label>Fart (km/t)<input type='number' step='1' value='${s.target?.speed||0}' data-f='speed' data-i='${j}' class='input seg'></label><label>Stigning (%)<input type='number' step='1' value='${s.target?.incline||0}' data-f='incline' data-i='${j}' class='input seg'></label><button class='btn danger' data-act='delseg' data-i='${j}'>Slett segment</button></div>`).join('')}<div class='footer-actions'><button class='btn' data-act='addseg'>+ Legg til segment</button></div></div>`; } el.querySelector('[data-act='rm']').onclick=rm; el.addEventListener('input', ev=>{ const t=ev.target; const f=t.dataset.f; if(!f) return; const B=cur.blocks[i]; if(t.classList.contains('seg')){ const k=+t.dataset.i; B.segments=B.segments||[]; const S=B.segments[k]||(B.segments[k]={target:{}}); if(f==='durationSec') S.durationSec=+t.value; else if(f==='speed') (S.target||(S.target={})).speed=+t.value; else if(f==='incline') (S.target||(S.target={})).incline=+t.value; } else { if(f==='durationSec') B.durationSec=+t.value; else if(f==='reps') B.reps=+t.value; else if(f==='workSec') B.workSec=+t.value; else if(f==='restSec') B.restSec=+t.value; else if(f==='speed') (B.target||(B.target={})).speed=+t.value; else if(f==='incline') (B.target||(B.target={})).incline=+t.value; else if(f==='intensity') B.intensity=t.value; } Store.save(); }); if(bl.kind==='continuous'){ el.querySelector('[data-act='addseg']').onclick=()=>{ bl.segments=bl.segments||[]; bl.segments.push({durationSec:60, target:{speed:10, incline:1}}); Store.save(); refresh(); }; el.querySelectorAll('[data-act='delseg']').forEach(btn=> btn.onclick=()=>{ const k=+btn.dataset.i; bl.segments.splice(k,1); Store.save(); refresh(); }); } b.appendChild(el); }); }
 sel.onchange=()=>{ const nw=Store.data.workouts.find(x=>x.id===sel.value); if(nw){ cur=nw; document.getElementById('wName').value=nw.name; refresh(); } }; document.getElementById('btnNew').onclick=()=>{ const nw={id:crypto.randomUUID(), name:'Ny økt', type:'custom', blocks:[]}; Store.data.workouts.push(nw); Store.save(); sel.insertAdjacentHTML('beforeend',`<option value='${nw.id}'>${nw.name}</option>`); sel.value=nw.id; cur=nw; refresh(); }; document.getElementById('btnDel').onclick=()=>{ if(confirm('Slette valgt økt?')){ const i=Store.data.workouts.findIndex(x=>x.id===sel.value); if(i>=0){ Store.data.workouts.splice(i,1); Store.save(); location.hash='#/'; } } }; document.getElementById('btnSave').onclick=()=>{ cur.name=document.getElementById('wName').value||cur.name; Store.save(); toast('Lagret'); }; document.getElementById('btnAddWarmup').onclick=()=>{ cur.blocks.push({kind:'warmup', durationSec:600, target:{speed:9, incline:1}, intensity:'Lett'}); Store.save(); refresh(); }; document.getElementById('btnAddSet').onclick=()=>{ cur.blocks.push({kind:'set', reps:4, workSec:240, restSec:180, target:{speed:14, incline:1}, intensity:'Hardt'}); Store.save(); refresh(); }; document.getElementById('btnAddCont').onclick=()=>{ cur.blocks.push({kind:'continuous', segments:[{durationSec:300, target:{speed:12, incline:1}}]}); Store.save(); refresh(); }; document.getElementById('btnAddCooldown').onclick=()=>{ cur.blocks.push({kind:'cooldown', durationSec:600, target:{speed:8.5, incline:1}, intensity:'Lett'}); Store.save(); refresh(); }; }
